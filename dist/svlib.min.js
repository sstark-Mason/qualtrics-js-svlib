"use strict";var svlib=(()=>{var re=Object.create;var F=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var D=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),le=(s,t)=>{for(var e in t)F(s,e,{get:t[e],enumerable:!0})},O=(s,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ce(t))!ue.call(s,n)&&n!==e&&F(s,n,{get:()=>t[n],enumerable:!(o=ae(t,n))||o.enumerable});return s};var L=(s,t,e)=>(e=s!=null?re(de(s)):{},O(t||!s||!s.__esModule?F(e,"default",{value:s,enumerable:!0}):e,s)),he=s=>O(F({},"__esModule",{value:!0}),s);var z=D((Ne,P)=>{var v=1e3,y=v*60,I=y*60,m=I*24,fe=m*7,ge=m*365.25;P.exports=function(s,t){t=t||{};var e=typeof s;if(e==="string"&&s.length>0)return be(s);if(e==="number"&&isFinite(s))return t.long?Ce(s):me(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function be(s){if(s=String(s),!(s.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s);if(t){var e=parseFloat(t[1]),o=(t[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return e*ge;case"weeks":case"week":case"w":return e*fe;case"days":case"day":case"d":return e*m;case"hours":case"hour":case"hrs":case"hr":case"h":return e*I;case"minutes":case"minute":case"mins":case"min":case"m":return e*y;case"seconds":case"second":case"secs":case"sec":case"s":return e*v;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function me(s){var t=Math.abs(s);return t>=m?Math.round(s/m)+"d":t>=I?Math.round(s/I)+"h":t>=y?Math.round(s/y)+"m":t>=v?Math.round(s/v)+"s":s+"ms"}function Ce(s){var t=Math.abs(s);return t>=m?_(s,t,m,"day"):t>=I?_(s,t,I,"hour"):t>=y?_(s,t,y,"minute"):t>=v?_(s,t,v,"second"):s+" ms"}function _(s,t,e,o){var n=t>=e*1.5;return Math.round(s/e)+" "+o+(n?"s":"")}});var K=D((je,V)=>{function ve(s){e.debug=e,e.default=e,e.coerce=te,e.disable=q,e.enable=n,e.enabled=ee,e.humanize=z(),e.destroy=se,Object.keys(s).forEach(i=>{e[i]=s[i]}),e.names=[],e.skips=[],e.formatters={};function t(i){let r=0;for(let c=0;c<i.length;c++)r=(r<<5)-r+i.charCodeAt(c),r|=0;return e.colors[Math.abs(r)%e.colors.length]}e.selectColor=t;function e(i){let r,c=null,d,C;function l(...p){if(!l.enabled)return;let b=l,S=Number(new Date),oe=S-(r||S);b.diff=oe,b.prev=r,b.curr=S,r=S,p[0]=e.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let x=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(Q,ne)=>{if(Q==="%%")return"%";x++;let J=e.formatters[ne];if(typeof J=="function"){let ie=p[x];Q=J.call(b,ie),p.splice(x,1),x--}return Q}),e.formatArgs.call(b,p),(b.log||e.log).apply(b,p)}return l.namespace=i,l.useColors=e.useColors(),l.color=e.selectColor(i),l.extend=o,l.destroy=e.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:()=>c!==null?c:(d!==e.namespaces&&(d=e.namespaces,C=e.enabled(i)),C),set:p=>{c=p}}),typeof e.init=="function"&&e.init(l),l}function o(i,r){let c=e(this.namespace+(typeof r>"u"?":":r)+i);return c.log=this.log,c}function n(i){e.save(i),e.namespaces=i,e.names=[],e.skips=[];let r=(typeof i=="string"?i:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let c of r)c[0]==="-"?e.skips.push(c.slice(1)):e.names.push(c)}function u(i,r){let c=0,d=0,C=-1,l=0;for(;c<i.length;)if(d<r.length&&(r[d]===i[c]||r[d]==="*"))r[d]==="*"?(C=d,l=c,d++):(c++,d++);else if(C!==-1)d=C+1,l++,c=l;else return!1;for(;d<r.length&&r[d]==="*";)d++;return d===r.length}function q(){let i=[...e.names,...e.skips.map(r=>"-"+r)].join(",");return e.enable(""),i}function ee(i){for(let r of e.skips)if(u(i,r))return!1;for(let r of e.names)if(u(i,r))return!0;return!1}function te(i){return i instanceof Error?i.stack||i.message:i}function se(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}V.exports=ve});var w=D((h,k)=>{h.formatArgs=Ie;h.save=Ee;h.load=qe;h.useColors=ye;h.storage=Se();h.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();h.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function ye(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ie(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+k.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;s.splice(1,0,t,"color: inherit");let e=0,o=0;s[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(e++,n==="%c"&&(o=e))}),s.splice(o,0,t)}h.log=console.debug||console.log||(()=>{});function Ee(s){try{s?h.storage.setItem("debug",s):h.storage.removeItem("debug")}catch{}}function qe(){let s;try{s=h.storage.getItem("debug")||h.storage.getItem("DEBUG")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=process.env.DEBUG),s}function Se(){try{return localStorage}catch{}}k.exports=K()(h);var{formatters:xe}=k.exports;xe.j=function(s){try{return JSON.stringify(s)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var ke={};le(ke,{describeThisQuestion:()=>U,enableComprehensionQuestion:()=>Z,enableFeedbackOnQuestion:()=>H,enableQuestionChoiceLogger:()=>Y,recordData:()=>_e,storeAllSessionFeedbackAsEmbeddedData:()=>R,testDataPersistence:()=>W});function U(s){let t=s.questionId;console.groupCollapsed("describeThisQuestion(%s)",t);let e=s.getQuestionInfo();console.info("Question Info: ",e);let o=s.getChoices();console.info("Question Choices: ",o),console.groupEnd()}function f(s){return s.replace(/^\d+_/,"")}function W(s){console.groupCollapsed("testDataPersistence");let t=s.questionId;console.group("calling testEmbed"),console.info("testEmbed: %s",Qualtrics.SurveyEngine.getJSEmbeddedData("testEmbed")),console.info("Setting to 'NEW VALUE of testEmbed'..."),Qualtrics.SurveyEngine.setJSEmbeddedData("testEmbed","NEW VALUE of testEmbed"),console.info("Retrieving testEmbed again (check against final response form): %s",Qualtrics.SurveyEngine.getJSEmbeddedData("testEmbed")),console.groupEnd(),console.group("calling __js_testEmbed"),console.info("__js_testEmbed: %s",Qualtrics.SurveyEngine.getJSEmbeddedData("__js_testEmbed")),console.info("Setting to 'NEW VALUE of __js_testEmbed'..."),Qualtrics.SurveyEngine.setJSEmbeddedData("__js_testEmbed","NEW VALUE of __js_testEmbed"),console.info("Retrieving __js_testEmbed again (check against final response form): %s",Qualtrics.SurveyEngine.getJSEmbeddedData("__js_testEmbed")),console.groupEnd(),console.group("calling __js___js_testEmbed"),console.info("__js___js_testEmbed: %s",Qualtrics.SurveyEngine.getJSEmbeddedData("__js___js_testEmbed")),console.info("Setting to 'NEW VALUE of __js___js_testEmbed'..."),Qualtrics.SurveyEngine.setJSEmbeddedData("__js___js_testEmbed","NEW VALUE of __js___js_testEmbed"),console.info("Retrieving __js___js_testEmbed again (check against final response form): %s",Qualtrics.SurveyEngine.getJSEmbeddedData("__js___js_testEmbed")),console.groupEnd();let e=sessionStorage.getItem("testData")??null;e?console.info("Session data loaded:",e):(console.warn("No session data found. Embedding..."),e="session test string",sessionStorage.setItem("testData",e));let o=localStorage.getItem("testData")??null;o?console.info("Local data loaded:",o):(console.warn("No local data found. Embedding..."),o="local test string",localStorage.setItem("testData",o)),console.groupEnd()}function M(s,t){try{let e=JSON.stringify(t);sessionStorage.setItem(s,e)}catch(e){console.error("Error saving session data: %s",e)}}function N(s){try{let t=sessionStorage.getItem(s);return t?JSON.parse(t):null}catch(t){return console.error("Error loading session data: %s",t),null}}function H(s,t){new j(s,t).init()}var pe={closedIconEmpty:"\u{1F5E8}\uFE0F",closedIconFilled:"\u{1F4AC}",openedIcon:"\u2714\uFE0F",storageKeySuffix:"_feedback"},j=class{constructor(t,e={}){this.qContext=t;this.questionId=f(t.questionId);let o=t.getQuestionContainer();this.qdWrapper=o.querySelector(".question-display-wrapper"),this.opts={...pe,...e}}init(){this.ensureWrapper(),this.createElements(),this.appendElements(),this.attachEvents(),this.loadSavedFeedback()}ensureWrapper(){getComputedStyle(this.qdWrapper).position==="static"&&(this.qdWrapper.style.position="relative"),this.qdWrapper.classList.add("feedback-wrapper")}createElements(){this.button=document.createElement("button"),this.button.type="button",this.button.classList.add("feedback-button"),this.button.textContent=this.opts.closedIconEmpty,this.button.title="Have feedback?",this.button.setAttribute("aria-expanded","false"),this.textarea=document.createElement("textarea"),this.textarea.classList.add("feedback-textarea"),this.textarea.placeholder="Please enter any comments about this question here."}appendElements(){this.qdWrapper.append(this.button,this.textarea)}attachEvents(){this.button.addEventListener("click",()=>this.toggleTextarea()),this.textarea.addEventListener("blur",t=>{this.saveFeedback(),this.updateButtonIcon(),t.relatedTarget!==this.button&&this.hideTextarea()})}toggleTextarea(){let t=this.textarea.classList.toggle("open");if(this.button.setAttribute("aria-expanded",String(t)),this.updateButtonIcon(t),t){let o=this.button.offsetWidth+5;this.textarea.style.right=`${o}px`,this.textarea.focus()}else this.hideTextarea(),this.saveFeedback()}hideTextarea(){this.textarea.classList.remove("open"),this.button.setAttribute("aria-expanded","false"),this.updateButtonIcon(!1),this.textarea.style.removeProperty("right")}updateButtonIcon(t=!1){t?(this.button.textContent=this.opts.openedIcon,this.button.style.transform="scaleX(1)"):this.textarea.value.trim()?(this.button.textContent=this.opts.closedIconFilled,this.button.style.transform="scaleX(-1)"):(this.button.textContent=this.opts.closedIconEmpty,this.button.style.transform="scaleX(1)")}saveFeedback(){let t=this.questionId+this.opts.storageKeySuffix,e=this.textarea.value.trim();e?sessionStorage.setItem(t,e):sessionStorage.removeItem(t)}loadSavedFeedback(){let t=this.questionId+this.opts.storageKeySuffix,e=sessionStorage.getItem(t);e&&(this.textarea.value=e,this.updateButtonIcon(!1))}};function R(){try{let s=Object.keys(sessionStorage).filter(e=>e.endsWith("_feedback")),t={};s.forEach(e=>{try{let o=e.split("_")[0],n=sessionStorage.getItem(e);t[o]=n}catch(o){console.error("Error processing feedback for key %s: %s",e,o)}}),Qualtrics.SurveyEngine.setJSEmbeddedData("feedbackData",JSON.stringify(t))}catch(s){console.error("Error storing session feedback as embedded data: %s",s)}}var X=L(w(),1),g=(0,X.default)("svlib:questionEventUtils"),E=class s{static{this.instance=null}constructor(){localStorage.setItem("debug","svlib:nextButtonManager"),this.requiredQuestions=[],g("NextButtonManager initialized with empty required questions list.")}static getInstance(){return window.nextButtonManager||(window.nextButtonManager=new s,g("Created new instance of NextButtonManager.")),window.nextButtonManager}registerQuestion(t){let e={questionId:f(t.questionId),passed:!1};this.requiredQuestions.includes(e)?g("Question %o is already registered with NextButtonManager.",e):(this.requiredQuestions.push(e),t.disableNextButton(),g("Registered question %o with NextButtonManager.",e))}unregisterQuestion(t){let e=f(t.questionId);this.requiredQuestions=this.requiredQuestions.filter(o=>o.questionId!==e),g("Unregistered question with id %s from NextButtonManager.",e)}checkOverallPassState(){return!this.requiredQuestions||this.requiredQuestions.length===0?(g("No required questions registered; passing by default."),!0):this.requiredQuestions.every(t=>t.passed)?(g("All registered questions passed; returning true."),!0):!1}setQuestionPassState(t,e){let o=f(t.questionId),n=this.requiredQuestions.find(u=>u.questionId===o);n?(n.passed=e,g("Set pass state for question %s to %s.",o,e)):g("Question %s not found in registered questions; cannot set pass state.",o)}clearQuestions(){this.requiredQuestions=[],g("Cleared all registered questions from NextButtonManager.")}};var G=L(w(),1),a=(0,G.default)("svlib:comprehensionQuestionUtils");function Z(s,t,e){new B(s,t,e).init()}var B=class{constructor(t,e=[],o=e){this.nextButtonManager=null;this.qContext=t,this.questionId=f(t.questionId),this.choiceInputs=t.getChoiceContainer().querySelectorAll("input[type='radio'], input[type='checkbox']"),this.correctChoices=e,this.requiredChoices=o,this.nextButtonManager=E.getInstance(),this.nextButtonManager.registerQuestion(t),a("ComprehensionQuestion instantiated for questionId: %s with correctChoices: %o and requiredChoices: %o",this.questionId,this.correctChoices,this.requiredChoices),a("%s choiceInputs: %o",this.questionId,this.choiceInputs)}init(){localStorage.setItem("debug","svlib:comprehensionQuestionUtils"),this.loadChoiceStates(),a("%s: Loaded choice states: %o",this.questionId,this.choiceInputs);let t=[];this.correctChoices.length>0&&(t.push(e=>this.checkClickedChoiceCorrectness(e,this.correctChoices)),t.push(e=>this.checkAllChoicesCorrectness(e,this.correctChoices))),this.requiredChoices.length>0&&t.push(e=>this.checkAllChoicesRequired(e,this.requiredChoices)),t.push(()=>this.saveChoiceStates()),this.attachChoiceListeners("click",t)}attachChoiceListeners(t,e){for(let o of this.choiceInputs)o.addEventListener(t,n=>{setTimeout(()=>{e.forEach(u=>u(n))},0)})}checkClickedChoiceCorrectness(t,e){a("%s: Checking clicked choice correctness.",this.questionId);let o=t.target,n=parseInt(o.id.split("-").pop(),10);return a("%s: Clicked choiceId %s.",this.questionId,n),e.includes(n)?(a("%s choice %s is correct; marking.",this.questionId,n),o.setAttribute("data-correctness","correct"),o.disabled=!0,this.scoreOnCorrectChoiceSelected(),!0):(e.includes(n)||(o.type==="radio"?(a("%s radio choice %s is incorrect; marking and disabling.",this.questionId,n),o.setAttribute("data-correctness","incorrect"),o.disabled=!0):o.type==="checkbox"&&(o.checked?(a("%s checkbox choice %s is incorrect; marking as incorrect.",this.questionId,n),o.setAttribute("data-correctness","incorrect")):(a("%s checkbox choice %s is incorrect; disabling after unselect.",this.questionId,n),o.setAttribute("data-correctness","incorrect"),o.disabled=!0))),!1)}checkAllChoicesCorrectness(t,e){let o=this.qContext.getSelectedChoices().map(Number);if(a("%s: Checking all choices correctness. Selected choices: %o",this.questionId,o),e.every(n=>o.includes(n))){a("All correct choices selected for questionId: %s",this.questionId);for(let n of this.choiceInputs)if(n.getAttribute("data-correctness")==="incorrect"&&n.checked){a("Checkbox %s input %s is selected but incorrect; allowing deselection.",this.questionId,n.id);continue}else a("Disabling %s input %s",this.questionId,n.id),n.disabled=!0;if(o.every(n=>e.includes(n)))return a("All choices are correct for questionId: %s",this.questionId),!0}else for(let n of this.choiceInputs)n.getAttribute("data-correctness")==="incorrect"&&!n.checked&&(n.disabled=!0);return!1}countCorrectness(t){let e=this.choiceInputs.length,o=0,n=0;for(let u of this.choiceInputs)u.getAttribute("data-correctness")==="correct"?o++:u.getAttribute("data-correctness")==="incorrect"&&n++}scoreCorrectness(t,e,o){let n=e+o;return n===0?0:e/n*100}scoreOnCorrectChoiceSelected(){let t=this.correctChoices.length,e=Array.from(this.choiceInputs).filter(q=>q.getAttribute("data-correctness")==="correct").length,o=t-e+1,n=Array.from(this.choiceInputs).filter(q=>q.getAttribute("data-correctness")==="hidden").length+1,u=1-o/n;return a("%s: Scoring from a correct choice selection. 1 - (numHiddenCorrectChoices / numHiddenChoices): 1 - (%d / %d) = %s.",this.questionId,o,n,u.toFixed(2)),Fe(this.qContext,u),u}checkAllChoicesRequired(t,e){a("Checking required choices for %s:",this.questionId);let o=this.qContext.getSelectedChoices().map(Number);return e.every(n=>o.includes(n))?(a("All required choices selected for questionId: %s",this.questionId),!0):(a("Not all required choices selected for questionId: %s",this.questionId),!1)}saveChoiceStates(){let t={};for(let e of this.choiceInputs){let o=e.id.split("-").pop();t[o]={correctness:e.getAttribute("data-correctness"),selected:e.checked,disabled:e.disabled}}M(this.questionId+"_choiceHistory",t),a("Saved choiceStates for %s: %o",this.questionId,t)}loadChoiceStates(){let t=N(this.questionId+"_choiceHistory")??{};for(let e of this.choiceInputs){let o=e.id.split("-").pop(),n=t[o];n?(e.setAttribute("data-correctness",n.correctness),e.checked=n.selected,e.disabled=n.disabled):(e.setAttribute("data-correctness","hidden"),e.checked=!1,e.disabled=!1),this.qContext.setChoiceAnswerValue(o,o,e.checked)}a("Loaded choiceStates for %s: %o",this.questionId,t)}};function Fe(s,t){let e=N("comprehensionScores")||{},o=f(s.questionId);e[o]||(e[o]=[]),e[o].push(t),M("comprehensionScores",e),a("Updated comprehension scores for %s: %o",o,e[o])}var $=L(w(),1),A=(0,$.default)("svlib:questionEventUtils");function Y(s){let t=new T(s,[e=>t.logEvent(e)]);t.init(),A("Enabled question choice logger for %s.",s.questionId)}var T=class{constructor(t,e){localStorage.setItem("debug","svlib:questionEventUtils"),this.qContext=t,this.callbacks=e,this.questionId=f(t.questionId);let o=t.getQuestionContainer(),n=t.getChoiceContainer();this.choiceInputs=n.querySelectorAll("input[type='radio'], input[type='checkbox']")}init(){}attachEventListener(t){let e=this.qContext.getQuestionContainer();if(!e){console.error("No question container found for questionId: %s",this.questionId);return}e.addEventListener(t,o=>{this.logEvent(o)}),A("Attached %s event listener to questionId: %s",t,this.questionId)}logEvent(t){let e={targetId:t.target.id,choiceId:t.target.id.split("-").pop(),eventType:t.type,timestamp:new Date().toISOString()};A("Event triggered: %o",e),A("Event: %o",t)}};window.nextButtonManager=new E;console.log("svlib loading...");function _e(s){console.debug("Recording data:",s)}console.info("svlib loaded and ready.");return he(ke);})();
//# sourceMappingURL=svlib.min.js.map
